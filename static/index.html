<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Vasu Gadde – AI Interview Assistant</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <style>
    body, html { font-family: 'Inter', sans-serif; background: #000; }
    .markdown p { margin: 0.75em 0; line-height: 1.7; }
    .markdown ul { padding-left: 1.5em; margin: 0.75em 0; list-style: disc; }
    .markdown code {
      background: rgba(15,23,42,0.8);
      padding: 0.2em 0.4em;
      border-radius: 6px;
      font-size: 0.9em;
    }
    .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
    .scrollbar-hide::-webkit-scrollbar { display: none; }

    .typing-dots span {
      display: inline-block;
      width: 8px; height: 8px;
      border-radius: 50%;
      background: #888;
      margin: 0 3px;
      animation: typing 1.4s infinite ease-in-out;
    }
    .typing-dots span:nth-child(1) { animation-delay: 0s; }
    .typing-dots span:nth-child(2) { animation-delay: 0.2s; }
    .typing-dots span:nth-child(3) { animation-delay: 0.4s; }
    @keyframes typing {
      0%,100% { transform: translateY(0); }
      50% { transform: translateY(-8px); }
    }

    #textInput {
      min-height: 56px;
      max-height: 200px;
      overflow-y: auto;
    }
  </style>
</head>

<body class="h-full bg-black text-white">

  <div class="flex h-screen">

    <!-- DESKTOP SIDEBAR (hidden on mobile) -->
    <div class="hidden md:flex flex-col w-64 bg-gray-900 border-r border-gray-800">
      <div class="p-5 border-b border-gray-800">
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center font-bold text-lg">VG</div>
          <div>
            <h2 class="font-semibold">Vasu Gadde</h2>
            <p class="text-xs text-gray-400">AI Interview Assistant</p>
          </div>
        </div>
      </div>
      <div class="flex-1 overflow-y-auto scrollbar-hide p-4">
        <p class="text-xs font-medium text-gray-500 uppercase tracking-wider mb-3">Suggested Questions</p>
        <div id="desktopQuestions" class="space-y-2"></div>
      </div>
    </div>

    <!-- MAIN CHAT AREA -->
    <div class="flex-1 flex flex-col">

      <!-- Messages -->
      <div id="chatMessages" class="flex-1 overflow-y-auto px-4 pt-6 pb-24 md:pb-8 scrollbar-hide">
        <div class="max-w-4xl mx-auto">
          <div class="flex gap-4 mb-8">
            <div class="w-10 h-10 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex-shrink-0 flex items-center justify-center font-bold">VG</div>
            <div class="prose prose-invert max-w-none text-gray-100">
              <p class="text-lg font-medium">Hi! I'm Vasu's AI interview assistant.</p>
              <p>You can ask me anything about his experience, projects, technical skills, or why he'd be a great fit for your team.</p>
              <p class="text-gray-400 text-sm mt-3">Try one of the suggested questions <span class="md:hidden">below</span><span class="hidden md:inline">on the left</span></p>
            </div>
          </div>
        </div>
      </div>

      <!-- MOBILE: Collapsible suggested questions -->
      <div class="md:hidden px-4 pb-3 bg-black border-b border-gray-800">
        <details class="cursor-pointer">
          <summary class="text-sm font-medium text-gray-300 py-2 flex justify-between items-center">
            Suggested questions
            <svg class="w-5 h-5 transition" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
          </summary>
          <div id="mobileQuestions" class="mt-3 space-y-2 pb-2"></div>
        </details>
      </div>

      <!-- INPUT BAR – Fixed on mobile, normal on desktop -->
      <div class="border-t border-gray-800 bg-black px-4 py-4 md:py-6">
        <div class="max-w-4xl mx-auto">
          <div class="relative bg-gray-800 rounded-xl border border-gray-700">
            <textarea
              id="textInput"
              rows="1"
              placeholder="Ask a question about Vasu..."
              class="w-full bg-transparent px-4 py-4 pr-14 text-white placeholder-gray-500 focus:outline-none resize-none text-base leading-relaxed"
            ></textarea>
            <button id="sendBtn" class="absolute right-2 bottom-2 w-11 h-11 rounded-lg bg-white hover:bg-gray-100 text-black flex items-center justify-center transition disabled:opacity-40">
              <svg class="h-6 w-6" viewBox="0 0 24 24" fill="currentColor">
                <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
              </svg>
            </button>
          </div>
          <!-- <p class="text-center text-xs text-gray-500 mt-2">Press Enter to send</p> -->
        </div>
      </div>

    </div>
  </div>

  <script>
    const BASE_URL = window.location.origin;
    const chatMessages = document.getElementById("chatMessages");
    const textInput = document.getElementById("textInput");
    const sendBtn = document.getElementById("sendBtn");
    const mobileQuestions = document.getElementById("mobileQuestions");
    const desktopQuestions = document.getElementById("desktopQuestions");

    let conversation = [];
    let isSending = false;
    let typingIndicator = null;

    const questions = [
      "Tell me about yourself",
      "Walk me through your experience at JHS Associates",
      "Explain the AI recruitment system you built",
      "What are your strongest technical skills?",
      "Why should we hire Vasu?",
      "Tell me about your WhatsApp Chat Analyzer",
      "Explain your Personal Research Assistant project",
      "What kind of roles are you targeting?"
    ];

    // Add questions
    [mobileQuestions, desktopQuestions].forEach(container => {
      questions.forEach(q => {
        const btn = document.createElement("button");
        btn.className = "w-full text-left px-4 py-3 rounded-lg hover:bg-gray-800 text-gray-300 text-sm transition";
        btn.textContent = q;
        btn.onclick = () => {
          textInput.value = q;
          textInput.focus();
          sendMessage(q);
          if (window.innerWidth < 768) document.querySelector('details').open = false;
        };
        container.appendChild(btn);
      });
    });

    textInput.addEventListener("input", () => {
      textInput.style.height = "auto";
      textInput.style.height = textInput.scrollHeight + "px";
      sendBtn.disabled = !textInput.value.trim();
    });

    function addUserMessage(text) {
      const div = document.createElement("div");
      div.className = "flex justify-end mb-6";
      div.innerHTML = `<div class="max-w-xl bg-gray-700 text-white rounded-2xl px-5 py-3 text-sm leading-relaxed">${text}</div>`;
      chatMessages.appendChild(div);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    function addAIMessage(text) {
      const div = document.createElement("div");
      div.className = "flex gap-4 mb-6";
      div.innerHTML = `
        <div class="w-10 h-10 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex-shrink-0 flex items-center justify-center font-bold">VG</div>
        <div class="flex-1 max-w-3xl prose prose-invert markdown text-gray-100">${marked.parse(text)}</div>`;
      chatMessages.appendChild(div);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    function showTyping() {
      typingIndicator = document.createElement("div");
      typingIndicator.className = "flex gap-4 mb-6";
      typingIndicator.innerHTML = `
        <div class="w-10 h-10 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex-shrink-0"></div>
        <div class="bg-gray-800 rounded-2xl px-5 py-4">
          <div class="typing-dots"><span></span><span></span><span></span></div>
        </div>`;
      chatMessages.appendChild(typingIndicator);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    function removeTyping() {
      if (typingIndicator) typingIndicator.remove();
    }

    async function sendMessage(text) {
      if (!text.trim() || isSending) return;
      text = text.trim();
      addUserMessage(text);
      textInput.value = "";
      textInput.style.height = "auto";
      sendBtn.disabled = true;
      isSending = true;
      showTyping();

      conversation.push({ role: "user", content: text });

      try {
        const res = await fetch(`${BASE_URL}/ask_question`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ question: text, messages: conversation })
        });
        const data = await res.json();
        conversation = data.messages || conversation;
        removeTyping();
        addAIMessage(data.response);
      } catch {
        removeTyping();
        addAIMessage("Sorry, something went wrong. Please try again.");
      } finally {
        isSending = false;
        sendBtn.disabled = false;
        textInput.focus();
      }
    }

    textInput.addEventListener("keydown", e => {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        sendMessage(textInput.value);
      }
    });

    sendBtn.addEventListener("click", () => sendMessage(textInput.value));

    // Focus on load
    textInput.focus();
  </script>
</body>
</html>