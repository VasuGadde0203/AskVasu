<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Vasu AI â€” Interview Assistant</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <style>
    body { font-family: Inter, sans-serif; }
    .markdown p { margin: 0.75em 0; line-height: 1.6; }

    /* Instagram style typing dots */
    .typing {
      display: flex;
      gap: 6px;
      align-items: center;
      padding: 12px 18px;
      background: #fff;
      border-radius: 14px;
      width: fit-content;
      border: 1px solid #e5e7eb;
      box-shadow: 0 1px 4px rgba(0,0,0,0.07);
      margin-left: 52px;
    }
    .typing-dot {
      width: 8px;
      height: 8px;
      background: #9ca3af;
      border-radius: 50%;
      animation: blink 1.4s infinite both;
    }
    .typing-dot:nth-child(2) { animation-delay: 0.2s; }
    .typing-dot:nth-child(3) { animation-delay: 0.4s; }

    @keyframes blink {
      0% { opacity: 0.2; transform: translateY(0px); }
      50% { opacity: 1; transform: translateY(-4px); }
      100% { opacity: 0.2; transform: translateY(0px); }
    }
  </style>
</head>

<body class="bg-gray-100">

  <div class="flex h-screen">

    <!-- SIDEBAR -->
    <aside class="hidden lg:flex flex-col w-72 bg-white border-r border-gray-200">

      <div class="p-6 border-b border-gray-200">
        <div class="flex items-center gap-3">
          <div class="w-12 h-12 rounded-lg bg-blue-600 text-white font-bold flex items-center justify-center">
            VG
          </div>
          <div>
            <h2 class="text-lg font-semibold text-gray-800">Vasu Gadde</h2>
            <p class="text-gray-500 text-sm">AI Interview Assistant</p>
          </div>
        </div>
      </div>

      <div class="flex-1 overflow-y-auto p-4 space-y-2">
        <p class="uppercase text-xs text-gray-400 font-medium">Suggested Questions</p>
        <div id="suggestedQs" class="space-y-2"></div>
      </div>

    </aside>

    <!-- MAIN CHAT AREA -->
    <main class="flex-1 flex flex-col">

      <!-- CHAT WINDOW -->
      <div id="chatWindow"
           class="flex-1 overflow-y-auto p-6 md:px-28 space-y-6">

        <div class="bg-white rounded-2xl shadow p-6 border border-gray-200 max-w-3xl mx-auto mt-4">
          <h1 class="text-2xl font-semibold">Hi, I'm Vasu's AI Interview Assistant ðŸ‘‹</h1>
          <p class="text-gray-600 mt-2">Ask anything about his experience, technical skills, or projects.</p>
        </div>

      </div>

      <!-- MOBILE SUGGESTED QUESTIONS -->
    <div class="lg:hidden bg-white border-t border-gray-200 p-4">
    <details class="cursor-pointer">
        <summary class="text-sm font-medium text-gray-700 py-2">
        Suggested questions
        </summary>
        <div id="mobileQuestions" class="mt-3 space-y-2"></div>
    </details>
    </div>


      <!-- INPUT BAR -->
      <div class="bg-white border-t border-gray-200 p-4">
        <div class="max-w-3xl mx-auto flex items-center gap-3">

          <textarea id="userInput"
                    class="flex-1 bg-gray-100 rounded-xl p-4 resize-none border border-gray-300 
                    focus:outline-none focus:ring-2 focus:ring-blue-500"
                    rows="1"
                    placeholder="Ask a question about Vasu..."></textarea>

          <button id="sendBtn"
                  class="bg-blue-600 hover:bg-blue-700 text-white w-12 h-12 rounded-xl flex items-center justify-center">
            âž¤
          </button>

        </div>
      </div>

    </main>

  </div>



<script>
  const BASE_URL = window.location.origin;

  const chatWindow = document.getElementById("chatWindow");
  const userInput  = document.getElementById("userInput");
  const sendBtn    = document.getElementById("sendBtn");
  const suggestedQs = document.getElementById("suggestedQs");

  let conversation = [];
  let typingEl = null;

  const questions = [
    "Tell me about yourself",
    "Walk me through your experience at JHS Associates",
    "Explain the AI recruitment system you built",
    "What are your strongest technical skills?",
    "Why should we hire Vasu?",
    "Tell me about your WhatsApp Chat Analyzer",
    "Explain your Personal Research Assistant project",
    "What kind of roles are you targeting?"
  ];

  const mobileQuestions = document.getElementById("mobileQuestions");

    questions.forEach(q => {
    const btn = document.createElement("button");
    btn.className = "w-full text-left px-4 py-3 rounded-xl bg-white border border-gray-200 hover:bg-gray-100";
    btn.textContent = q;
    btn.onclick = () => sendMessage(q);
    mobileQuestions.appendChild(btn);
    });


  // Render suggested questions
  questions.forEach(q => {
    const btn = document.createElement("button");
    btn.className =
      "w-full text-left px-4 py-3 rounded-xl bg-white border border-gray-200 hover:bg-gray-100 text-gray-700 shadow-sm";
    btn.textContent = q;
    btn.onclick = () => sendMessage(q);
    suggestedQs.appendChild(btn);
  });

  /* ------------------- UI Helpers --------------------- */

  function addUserBubble(text) {
    const div = document.createElement("div");
    div.className = "flex justify-end";
    div.innerHTML = `
      <div class="max-w-xl bg-blue-600 text-white rounded-2xl px-5 py-3 shadow">
        ${text}
      </div>`;
    chatWindow.appendChild(div);
    chatWindow.scrollTop = chatWindow.scrollHeight;
  }

//   function addAIBubble(text) {
//     const div = document.createElement("div");
//     div.className = "flex gap-3 max-w-3xl";

//     div.innerHTML = `
//       <div class="w-10 h-10 bg-blue-600 text-white rounded-lg flex items-center justify-center font-bold">VG</div>
//       <div class="bg-white border border-gray-200 rounded-2xl px-5 py-4 shadow markdown">
//         ${marked.parse(text)}
//       </div>`;

//     chatWindow.appendChild(div);
//     chatWindow.scrollTop = chatWindow.scrollHeight;
//   }
    
  function addAIBubble(text) {
  const wrapper = document.createElement("div");
  wrapper.className = "w-full flex justify-start";

  const div = document.createElement("div");
  div.className = "flex items-start gap-3 w-full max-w-[90%] md:max-w-3xl";   /* RESPONSIVE */

  div.innerHTML = `
    <div class="flex-shrink-0 w-12 h-12 rounded-full bg-blue-600 text-white 
                flex items-center justify-center font-semibold shadow-sm text-base">
      VG
    </div>

    <div class="bg-white border border-gray-200 rounded-2xl px-5 py-4 shadow markdown w-full">
      ${marked.parse(text)}
    </div>
  `;

  wrapper.appendChild(div);
  chatWindow.appendChild(wrapper);
  chatWindow.scrollTop = chatWindow.scrollHeight;
}




  /* ---------------- Typing Indicator ---------------- */

  function showTyping() {
    typingEl = document.createElement("div");
    typingEl.className = "typing";
    typingEl.innerHTML = `
      <span class="typing-dot"></span>
      <span class="typing-dot"></span>
      <span class="typing-dot"></span>
    `;
    chatWindow.appendChild(typingEl);
    chatWindow.scrollTop = chatWindow.scrollHeight;
  }

  function hideTyping() {
    if (typingEl) typingEl.remove();
  }

  /* ---------------- Main Send Function ---------------- */

  async function sendMessage(text) {
    if (!text.trim()) return;

    addUserBubble(text);
    userInput.value = "";

    // Append user message to conversation history
    conversation.push({ role: "user", content: text });

    showTyping();

    try {
      const res = await fetch(`${BASE_URL}/ask_question`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          question: text,
          messages: conversation
        })
      });

      const data = await res.json();

      hideTyping();
      addAIBubble(data.response);

      // Update conversation history
      conversation = data.messages;

    } catch (err) {
      hideTyping();
      addAIBubble("Server error. Please try again.");
      console.error("API ERROR:", err);
    }
  }

  sendBtn.onclick = () => sendMessage(userInput.value);

  userInput.addEventListener("keydown", e => {
    if (e.key === "Enter" && !e.shiftKey) {
      e.preventDefault();
      sendMessage(userInput.value);
    }
  });
</script>

</body>
</html>
